<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è v2.1.1</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #1a1a2e;
            color: white;
            font-family: Arial, sans-serif;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #00d2ff;
            text-align: center;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .section {
            background: #16213e;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #00d2ff;
        }
        .section h2 {
            color: #00d2ff;
            margin-top: 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-weight: bold;
        }
        .ok { background: #10b981; color: white; }
        .error { background: #ef4444; color: white; }
        .warning { background: #fbbf24; color: black; }
        button {
            padding: 10px 20px;
            margin: 5px;
            background: #0f3460;
            border: 2px solid #00d2ff;
            color: #00d2ff;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #00d2ff;
            color: #0f3460;
        }
        code {
            background: #0f3460;
            padding: 5px 10px;
            border-radius: 3px;
            font-family: monospace;
        }
        .canvas-container {
            background: #0f3460;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
        }
        canvas {
            border: 2px solid #00d2ff;
            max-width: 400px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –£–ø—Ä–∞–≤–ª–µ–Ω–∏—è SKYNAS Maze v2.1.1</h1>
        
        <div class="grid">
            <div class="section">
                <h2>üìä –°—Ç–∞—Ç—É—Å –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</h2>
                <div id="component-status"></div>
            </div>
            
            <div class="section">
                <h2>‚å®Ô∏è –°–æ—Å—Ç–æ—è–Ω–∏–µ –ö–ª–∞–≤–∏—à</h2>
                <div id="keys-status"></div>
                <p><em>–ù–∞–∂–∏–º–∞–π—Ç–µ –∫–ª–∞–≤–∏—à–∏ ‚Üë‚Üì‚Üê‚Üí –∏–ª–∏ WASD</em></p>
            </div>
            
            <div class="section">
                <h2>üë§ –ü–æ–∑–∏—Ü–∏—è –ò–≥—Ä–æ–∫–∞</h2>
                <div id="player-status"></div>
            </div>
            
            <div class="section">
                <h2>üéÆ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h2>
                <button onclick="testMovement()">üß™ –¢–µ—Å—Ç –î–≤–∏–∂–µ–Ω–∏—è</button>
                <button onclick="manualMove('up')">‚¨ÜÔ∏è –í–≤–µ—Ä—Ö</button>
                <button onclick="manualMove('down')">‚¨áÔ∏è –í–Ω–∏–∑</button>
                <button onclick="manualMove('left')">‚¨ÖÔ∏è –í–ª–µ–≤–æ</button>
                <button onclick="manualMove('right')">‚û°Ô∏è –í–ø—Ä–∞–≤–æ</button>
            </div>
            
            <div class="section" style="grid-column: 1 / -1;">
                <h2>üéÆ –õ–∞–±–∏—Ä–∏–Ω—Ç</h2>
                <div class="canvas-container">
                    <canvas id="diagnostic-canvas" width="400" height="400"></canvas>
                </div>
                <p id="canvas-info"></p>
            </div>
            
            <div class="section" style="grid-column: 1 / -1;">
                <h2>üìã –ö–æ–º–∞–Ω–¥—ã –ö–æ–Ω—Å–æ–ª–∏</h2>
                <p>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª—å (F12):</p>
                <code>fullDebug()</code> - –ø–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞<br>
                <code>debugGameState()</code> - —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã<br>
                <code>testInputManager()</code> - —Ç–µ—Å—Ç –≤–≤–æ–¥–∞<br>
                <code>testPhysics()</code> - —Ç–µ—Å—Ç —Ñ–∏–∑–∏–∫–∏<br>
                <code>manualMove('up')</code> - —Ä—É—á–Ω–æ–µ –¥–≤–∏–∂–µ–Ω–∏–µ
            </div>
        </div>
    </div>
    
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π –í –ö–û–ù–¶–ï -->
    <script src="maze-engine.js"></script>
    <script src="maze-renderer.js"></script>
    <script src="maze-input.js"></script>
    <script src="maze-audio.js"></script>
    <script src="maze-physics.js"></script>
    <script src="maze-story.js"></script>
    <script src="maze-main.js"></script>
    <script src="DEBUG.js"></script>
    
    <script>
        console.log('üìã –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∏–π HTML –∑–∞–≥—Ä—É–∂–µ–Ω');
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
        function updateStatus() {
            const statuses = {
                'engine': window.engine ? '‚úÖ OK' : '‚ùå NOT FOUND',
                'renderer': window.renderer ? '‚úÖ OK' : '‚ùå NOT FOUND',
                'inputManager': window.inputManager ? '‚úÖ OK' : '‚ùå NOT FOUND',
                'physicsEngine': window.physicsEngine ? '‚úÖ OK' : '‚ùå NOT FOUND',
                'audioManager': window.audioManager ? '‚úÖ OK' : '‚ùå NOT FOUND',
                'storyManager': window.storyManager ? '‚úÖ OK' : '‚ùå NOT FOUND',
                'gameState': window.gameState ? '‚úÖ OK' : '‚ùå NOT FOUND'
            };
            
            let html = '';
            for (let [key, status] of Object.entries(statuses)) {
                const isOk = status.includes('‚úÖ');
                html += `<div class="status ${isOk ? 'ok' : 'error'}">${key}: ${status}</div>`;
            }
            document.getElementById('component-status').innerHTML = html;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–ª–∞–≤–∏—à
        function updateKeys() {
            if (!window.inputManager) return;
            
            const keys = ['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'w', 'a', 's', 'd'];
            let html = '';
            keys.forEach(key => {
                const isPressed = window.inputManager.keys[key];
                html += `<div class="status ${isPressed ? 'ok' : 'warning'}">${key}: ${isPressed ? 'PRESSED' : 'released'}</div>`;
            });
            document.getElementById('keys-status').innerHTML = html;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞
        function updatePlayer() {
            if (!window.gameState || !window.engine) return;
            
            const player = window.gameState.player;
            const engine = window.engine;
            html = `
                <div class="status ok">X: ${player.x}</div>
                <div class="status ok">Y: ${player.y}</div>
                <div class="status ok">Level: ${engine.level}</div>
                <div class="status ok">Size: ${engine.cols}x${engine.rows}</div>
            `;
            document.getElementById('player-status').innerHTML = html;
        }
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ –ª–∞–±–∏—Ä–∏–Ω—Ç–∞
        function drawDiagnosticMaze() {
            if (!window.engine || !window.renderer) return;
            
            const canvas = document.getElementById('diagnostic-canvas');
            if (!canvas) return;
            
            try {
                window.renderer.draw(window.engine, window.gameState.player);
                document.getElementById('canvas-info').innerHTML = '‚úÖ –õ–∞–±–∏—Ä–∏–Ω—Ç –æ—Ç—Ä–∏—Å–æ–≤—ã–≤–∞–µ—Ç—Å—è';
            } catch (e) {
                document.getElementById('canvas-info').innerHTML = '‚ùå –û—à–∏–±–∫–∞ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏: ' + e.message;
            }
        }
        
        // –¢–µ—Å—Ç –¥–≤–∏–∂–µ–Ω–∏—è
        function testMovement() {
            console.log('üß™ –ù–∞—á–∏–Ω–∞—é —Ç–µ—Å—Ç –¥–≤–∏–∂–µ–Ω–∏—è...');
            
            if (!window.physicsEngine || !window.gameState || !window.inputManager) {
                console.error('‚ùå –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã');
                return;
            }
            
            const directions = ['up', 'down', 'left', 'right'];
            directions.forEach(dir => {
                manualMove(dir);
                console.log(`${dir}: (${window.gameState.player.x}, ${window.gameState.player.y})`);
            });
            
            console.log('‚úÖ –¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.addEventListener('load', () => {
            setTimeout(() => {
                console.log('üìä –û–±–Ω–æ–≤–ª—è—é —Å—Ç–∞—Ç—É—Å...');
                updateStatus();
                updatePlayer();
                drawDiagnosticMaze();
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 100ms
                setInterval(() => {
                    updateKeys();
                    updatePlayer();
                }, 100);
            }, 500);
        });
        
        // –î–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–æ–≥–æ HTML - —Å—Ä–∞–∑—É –ø—Ä–æ–≤–µ—Ä—è–µ–º
        console.log('üîç –ü—Ä–æ–≤–µ—Ä—è—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã...');
        setTimeout(() => {
            console.log('window.engine:', !!window.engine);
            console.log('window.renderer:', !!window.renderer);
            console.log('window.physicsEngine:', !!window.physicsEngine);
            if (!window.engine) {
                console.error('‚ùå engine –Ω–µ —Å–æ–∑–¥–∞–Ω! initGame –Ω–µ –≤—ã–∑–≤–∞–Ω–∞?');
            }
        }, 2000);
    </script>
</body>
</html>
